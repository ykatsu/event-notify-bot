# event-notify-bot

#### Google Calenderの通知をSlackへPostするBot作ってみた

本日の予定一覧をつぶやくbotは多いけど、予定に設定してある通知の時刻になったら教えてくれるbotが見当たらなかったので GAS(Googls Apps Script) で作ってみた。  
(Slack の Integration API に Google Calendar はあるんだけど、これも予定の時間になったら教えてくれるだけで、５分前とか教えてくれないからマジツカエネ。)

#### 注意事項

GAS(Googls Apps Script) をサーバーとして利用しています。良くある Hubot+heroku ではありませんのでご注意ください。

GASへ貼り付ける時は Javascriptへコンパイルしてご使用ください。Chrome 上の CoffeeConsole がお手軽かな？

そもそもトリガが毎分起動じゃなく１分毎起動なので１分以内の誤差があるし、GASサーバーがそんなキッチリ働くかもわからないので、その辺を勘案の上ご利用ください。

上記の対策として、シートのB1の場所に前回処理した時間を取っておいて、それ以降現在までに起きた通知を見つけて出力するようにしています。なので、わざとここに時間に変換できない文字列入れるとどうなっても知りません。

終日予定の通知の取得方法が分からなかった為、それに関しては通知されません。

#### 処理説明

1. Calendar オブジェクトを取得
1. 前回の処理から現在までのイベントを全て取得
1. 各イベントのポップアップ通知を全て取得
1. 通知のうち、対象時間内のものがあれば Slack へ Post
1. その時にイイカンジのメッセージが出る様にごにょごにょ

#### 設定方法

1. Googleマイドライブ上で新規にスプレッドシート作成
1. [ツール]-[スクリプトエディタ] でエディタ起動
1. Javascript化したソースを貼り付ける
1. SlackApp をライブラリに追加。こことか参考に-> [Slack BotをGASでいい感じで書くためのライブラリを作った](http://qiita.com/soundTricker/items/43267609a870fc9c7453)
1. ソース先頭の各種リテラル (Slackのtoken、投稿するチャンネルのid、カレンダーid)  を適宜設定する(取得方法はぐぐってね)
1. [リソース]-[現在のプロジェクトのトリガー] からトリガーをdoPostに設定する。  
このとき、coffeescriptからコンパイルしたソースだとdoPostメソッドが見つからないというエラーになる場合がある。その場合はdoPost を変数からメソッドへ変更する。

JavaScript ソース上で、これを
```javascript
doPost = function() {
```
こうする
```javascript
function doPost() {
```
